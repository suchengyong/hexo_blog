<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/suchengyonglogo.png"/>
	<link rel="shortcut icon" href="/img/suchengyonglogo.png">
	<meta name="baidu-site-verification" content="3MRZfh0dC4" />
	
			
    <title>
    苏成勇个人博客
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">欢迎来到苏成勇个人博客</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Hexo/">Hexo</a></li><li><a class="category-link" href="/categories/canvas/">canvas</a></li><li><a class="category-link" href="/categories/js/">js</a></li><li><a class="category-link" href="/categories/前端开发/">前端开发</a></li><li><a class="category-link" href="/categories/小程序开发/">小程序开发</a></li><li><a class="category-link" href="/categories/移动端自适应/">移动端自适应</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tags/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/suchengyong" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		                <li><a href="https://suchengyong.netlify.app" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
		            
		            
		            
		                <li><a href="https://simple-ui.netlify.app#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(http://img4.imgtn.bdimg.com/it/u=3263972081,414179183&amp;fm=26&amp;gp=0.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >关于小程序上拉加载更多...</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h2 id="loadmore加载更多-使用分页加载"><a href="#loadmore加载更多-使用分页加载" class="headerlink" title="loadmore加载更多(使用分页加载)"></a>loadmore加载更多(使用分页加载)</h2><p>当用户打开一个页面时，假设后台数据量庞大时，一次性地返回所有数据给客户端，页面的打开速度就会有所下降，而且用户只看上面的内容而不需要看后面的内容时，也浪费用户流量，基于优化的角度来考虑，后台不要一次性返回所有数据，当用户有需要再往下翻的时候，再加载更加数据出来。</p>
<h2 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h2><p>列表滚动到底部时，继续往上拉，加载更多内容</p>
<h2 id="必备参数"><a href="#必备参数" class="headerlink" title="必备参数"></a>必备参数</h2><ul>
<li>pageindex: 1 //第几次加载</li>
<li>callbackcount: 15 //需要返回数据的个数</li>
</ul>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>当第一次访问接口时，传递2个必备参数（第1次加载，需要返回数据的个数为15个），和其他参数（需要搜索的字符串）给后台，后台返回第一次数据过来。在请求成功的的回调函数中，判断返回的数据是否&gt;0，是，则取出数据，渲染视图层，并把“上拉加载”显示在列表底部；否，则没有数据可取，并把“没有更多”显示在列表底部，同时把“上拉加载”隐藏掉。</p>
<p>当用户已经滚动到列表底部（这里使用到小程序提供的scroll-view组件的bindscrolltolower事件），触发bindscrolltolower事件，参数pageindex+1，再把2个必备参数（第2次加载，需要返回数据的个数为15个）和其他参数（需要搜索的字符串）给后台，后台把其余的数据返回给前台，前台在原来数据的基础上添加数据。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>wxml:</p>
<pre><code>&lt;view class=&quot;search&quot;&gt;  
  &lt;view class=&quot;search-bar&quot;&gt;  
    &lt;view class=&quot;search-wrap&quot;&gt;  
        &lt;icon type=&quot;search&quot; size=&quot;16&quot; class=&quot;icon-search&quot; /&gt;  
        &lt;input type=&quot;text&quot; placeholder=&quot;请输入搜索内容&quot; class=&quot;search-input&quot;
         name=&quot;searchKeyword&quot; bindinput=&quot;bindKeywordInput&quot; value=&quot;{{searchKeyword}}&quot; /&gt;  
    &lt;/view&gt;  
    &lt;view class=&quot;search-cancel&quot; bindtap=&quot;keywordSearch&quot;&gt;搜索&lt;/view&gt;  
  &lt;/view&gt;  
  &lt;view class=&quot;search-result&quot;&gt;  
    &lt;scroll-view scroll-y=&quot;true&quot; bindscrolltolower=&quot;searchScrollLower&quot;&gt;  
      &lt;view class=&quot;result-item&quot; wx:for=&quot;{{searchSongList}}&quot; wx:key=&quot;unique&quot;  
      data-data=&quot;{{item}}&quot; &gt;  
        &lt;view class=&quot;icon{{item.isonly=='0' ? ' nocopyright' : ''}}&quot;&gt;&lt;/view&gt;  
        &lt;text class=&quot;title&quot;&gt;{{item.songname}}&lt;/text&gt;  
        &lt;view class=&quot;subtitle&quot;&gt;  
          &lt;text wx:for=&quot;{{item.singer}}&quot; wx:key=&quot;unique&quot;&gt;{{item.name}}&lt;/text&gt;  
        &lt;/view&gt;  
      &lt;/view&gt;  
      &lt;view class=&quot;loading&quot; hidden=&quot;{{!searchLoading}}&quot;&gt;正在载入更多...&lt;/view&gt;  
      &lt;view class=&quot;loading complete&quot; hidden=&quot;{{!searchLoadingComplete}}&quot;&gt;已加载全部&lt;/view&gt;  
    &lt;/scroll-view&gt;    
  &lt;/view&gt;  
&lt;/view&gt;
</code></pre><p>js:</p>
<pre><code>var util = require(&#39;../../utils/util.js&#39;)  
Page({  
  data: {  
    searchKeyword: &#39;&#39;,  //需要搜索的字符  
    searchSongList: [], //放置返回数据的数组  
    isFromSearch: true,   // 用于判断searchSongList数组是不是空数组，默认true，空的数组  
    searchPageNum: 1,   // 设置加载的第几次，默认是第一次  
    callbackcount: 15,      //返回数据的个数  
    searchLoading: false, //&quot;上拉加载&quot;的变量，默认false，隐藏  
    searchLoadingComplete: false  //“没有数据”的变量，默认false，隐藏  
  },  
  //输入框事件，每输入一个字符，就会触发一次  
  bindKeywordInput: function(e){  
    console.log(&quot;输入框事件&quot;)  
    this.setData({  
      searchKeyword: e.detail.value  
    })  
  },  
  //搜索，访问网络  
  fetchSearchList: function(){  
    let that = this;  
    let searchKeyword = that.data.searchKeyword,//输入框字符串作为参数  
        searchPageNum = that.data.searchPageNum,//把第几次加载次数作为参数  
        callbackcount =that.data.callbackcount; //返回数据的个数  
    //访问网络  
    util.getSearchMusic(searchKeyword, searchPageNum,callbackcount, 
      function(data){  
      console.log(data)  
      //判断是否有数据，有则取数据  
      if(data.data.song.curnum != 0){  
        let searchList = [];  
        //如果isFromSearch是true从data中取出数据，否则先从原来的数据继续添加  
        that.data.isFromSearch ? searchList=data.data.song.list :
        searchList=that.data.searchSongList.concat(data.data.song.list)  
        that.setData({  
          searchSongList: searchList, //获取数据数组  
          zhida: data.data.zhida, //存放歌手属性的对象  
          searchLoading: true   //把&quot;上拉加载&quot;的变量设为false，显示  
        });  
      //没有数据了，把“没有数据”显示，把“上拉加载”隐藏  
      }else{  
        that.setData({  
          searchLoadingComplete: true, //把“没有数据”设为true，显示  
          searchLoading: false  //把&quot;上拉加载&quot;的变量设为false，隐藏  
        });  
      }  
    })  
  },  
  //点击搜索按钮，触发事件  
  keywordSearch: function(e){  
    this.setData({    
      searchPageNum: 1,   //第一次加载，设置1  
      searchSongList:[],  //放置返回数据的数组,设为空  
      isFromSearch: true,  //第一次加载，设置true  
      searchLoading: true,  //把&quot;上拉加载&quot;的变量设为true，显示  
      searchLoadingComplete:false //把“没有数据”设为false，隐藏  
    })  
    this.fetchSearchList();  
  },  
  //滚动到底部触发事件  
  searchScrollLower: function(){  
    let that = this;  
    if(that.data.searchLoading &amp;&amp; !that.data.searchLoadingComplete){  
      that.setData({  
        searchPageNum: that.data.searchPageNum+1,  //每次触发上拉事件，把searchPageNum+1  
        isFromSearch: false  //触发到上拉事件，把isFromSearch设为为false  
      });  
      that.fetchSearchList();  
    }  
  }  
})
</code></pre><p>uilt.js:</p>
<pre><code>function getSearchMusic(keyword, pageindex, callbackcount, callback){  
  wx.request({  
    url: &#39;https://c.y.qq.com/soso/fcgi-bin/search_for_qq_cp&#39;,  
    data: {  
      g_tk: 5381,  
      uin: 0,  
      format: &#39;json&#39;,  
      inCharset: &#39;utf-8&#39;,  
      outCharset: &#39;utf-8&#39;,  
      notice: 0,  
      platform: &#39;h5&#39;,  
      needNewCode: 1,  
      w: keyword,  
      zhidaqu: 1,  
      catZhida: 1,  
      t: 0,  
      flag: 1,  
      ie: &#39;utf-8&#39;,  
      sem: 1,  
      aggr: 0,  
      perpage: 20,  
      n: callbackcount,  //返回数据的个数  
      p: pageindex,  
      remoteplace: &#39;txt.mqq.all&#39;,  
      _: Date.now()  
    },  
    method: &#39;GET&#39;,  
    header: {&#39;content-Type&#39;: &#39;application/json&#39;},  
    success: function(res){  
      if(res.statusCode == 200){  
        callback(res.data);  
      }  
    }  
  })  
}  

module.exports = {  
  getSearchMusic: getSearchMusic  
}
</code></pre><p>wxss:</p>
<pre><code>page{  
  display: flex;  
  flex-direction: column;  
  height: 100%;  
}  

/*搜索*/  
.search{  
  flex: auto;  
  display: flex;  
  flex-direction: column;  
  background: #fff;  
}  
.search-bar{  
  flex: none;  
  display: flex;  
  align-items: center;  
  justify-content: space-between;  
  padding: 20rpx;  
  background: #f4f4f4;  
}  
.search-wrap{  
  position: relative;  
  flex: auto;  
  display: flex;  
  align-items: center;  
  height: 80rpx;  
  padding: 0 20rpx;  
  background: #fff;  
  border-radius: 6rpx;  
}  
.search-wrap .icon-search{  
  margin-right: 10rpx;  
}  
.search-wrap .search-input{  
  flex: auto;  
  font-size: 28rpx;  
}  
.search-cancel{  
  padding: 0 20rpx;  
  font-size: 28rpx;  
}  

/*搜索结果*/  
.search-result{  
  flex: auto;  
  position: relative;  
}  
.search-result scroll-view{  
  position: absolute;  
  bottom: 0;  
  left: 0;  
  right: 0;  
  top: 0;  
}  
.result-item{  
  position: relative;  
  display: flex;  
  flex-direction: column;  
  padding: 20rpx 0 20rpx 110rpx;  
  overflow: hidden;  
  border-bottom: 2rpx solid #e5e5e5;  
}  

.result-item .media{  
  position: absolute;  
  left: 16rpx;  
  top: 16rpx;  
  width: 80rpx;  
  height: 80rpx;  
  border-radius: 999rpx;  
}  
.result-item .title,  
.result-item .subtitle{  
  overflow: hidden;  
  text-overflow: ellipsis;  
  white-space: nowrap;  
  line-height: 36rpx;  
}  
.result-item .title{  
  margin-bottom: 4rpx;  
  color: #000;  
}  
.result-item .subtitle{  
  color: #808080;  
  font-size: 24rpx;  
}  
.result-item:first-child .subtitle text{  
  margin-right: 20rpx;  
}  
.result-item:not(:first-child) .subtitle text:not(:first-child):before{  
  content: &#39;/&#39;;  
  margin: 0 8rpx;  
}  
.loading{  
  padding: 10rpx;  
  text-align: center;  
}  
.loading:before{  
  display: inline-block;  
  margin-right: 5rpx;  
  vertical-align: middle;  
  content: &#39;&#39;;  
  width: 40rpx;  
  height: 40rpx;  
  background: url(../../images/icon-loading.png) no-repeat;  
  background-size: contain;  
  animation: rotate 1s linear infinite;  
}  
.loading.complete:before{  
  display: none;  
}
</code></pre><p>运行：</p>
<p><img src="http://img.blog.csdn.net/20170224172949375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbWljaGFlbF9vdXlhbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="图片"></p>
<p>说明：此文章转载于<a href="http://blog.csdn.net/michael_ouyang/article/details/56846185">微信小程序之加载更多（分页加载）实例 —— 微信小程序实战系列（2）</a></p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2018/02/07/wacharts/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cytsgGBWa';
var conf = 'prod_d517f84e6eeb56312a39e3df9a6c43d8';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2020总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
